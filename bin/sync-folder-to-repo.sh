#!/usr/bin/env bash

set -e

repo_path="${1%/}"

folder_path="${2:-pub/}"

rsync -vv --delete --exclude .git --exclude .github --exclude .gitignore -r "${folder_path%/}/" "$repo_path/"
pushd "$repo_path"

upstream_rev_shortsha="$(cat klippy/.version)"
commit_message="Autogenerated - Upstream $upstream_rev_shortsha"

git add .
git commit --allow-empty -m "$commit_message"

popd
